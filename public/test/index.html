<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <title>Test CardField</title>
  <script src="http://code.jquery.com/jquery.min.js" type="text/javascript" charset="utf-8"></script>
  <script type="text/javascript" charset="utf-8" src="http://jcaret.googlecode.com/files/jquery.caret.1.02.min.js"></script>
  <script src="/lib/formatted_text_field.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
  <input type="text" id="month-year-test" placeholder="mm/yy" />
  <input type="text" id="no-selection-test" placeholder="no selection" />

  <script type="text/javascript" charset="utf-8">
  jQuery(function($) {
    var $monthYearInput = $('#month-year-test');
    var monthYearField = new FormattedTextField($monthYearInput);

    monthYearField.formatter = {
      format: function(value) {
        var month, year;

        if (value)
          month = value.month, year = value.year;

        if (month === undefined) month = null;
        if (year === undefined) year = null;

        if (month) {
          if (year)
            return month + '/' + (year % 100);
          else
            return month;
        } else {
          return '';
        }
      },

      parse: function(text) {
        var monthAndYear = text.split('/'),
            month = monthAndYear[0],
            year = monthAndYear[1];

        if (month !== null) {
          month = Number(month);
        }

        if (year !== null) {
          year = Number(year);
        }

        return { month: month, year: year };
      },

      isChangeValid: function(change) {
        var monthAndYear = change.field.text.split('/');

        if (change.inserted.text && !/^\d+$/.test(change.inserted.text)) {
          return false;
        }

        return monthAndYear.length < 3;
      }
    };

    var $noSelectionInput = $('#no-selection-test');
    var noSelectionField = new FormattedTextField($noSelectionInput);

    noSelectionField.formatter = {
      format: function(value){ return value; },
      parse: function(value){ return value; },

      isChangeValid: function(change) {
        var caret = change.proposed.caret;
        if (caret.start !== caret.end) {
          if (change.field.selectionAnchor === caret.end)
            caret.end = caret.start
          else
            caret.start = caret.end;
        }

        return true;
      }
    };
  });
  </script>
</body>
</html>
