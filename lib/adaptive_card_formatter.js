// Generated by CoffeeScript 1.6.2
(function() {
  var AMEX, AdaptiveCardFormatter, AmexCardFormatter, DefaultCardFormatter, determineCardType, _ref;

  AmexCardFormatter = require('./amex_card_formatter');

  DefaultCardFormatter = require('./default_card_formatter');

  _ref = require('./card_utils'), determineCardType = _ref.determineCardType, AMEX = _ref.AMEX;

  AdaptiveCardFormatter = (function() {
    function AdaptiveCardFormatter() {
      this.amexCardFormatter = new AmexCardFormatter();
      this.defaultCardFormatter = new DefaultCardFormatter();
      this.formatter = this.defaultCardFormatter;
    }

    AdaptiveCardFormatter.prototype.format = function(pan) {
      return this._formatterForPan(pan).format(pan);
    };

    AdaptiveCardFormatter.prototype.parse = function(text, error) {
      return this.formatter.parse(text, error);
    };

    AdaptiveCardFormatter.prototype.isChangeValid = function(change) {
      this.formatter = this._formatterForPan(change.proposed.text);
      return this.formatter.isChangeValid(change);
    };

    AdaptiveCardFormatter.prototype._formatterForPan = function(pan) {
      if (determineCardType(pan.replace(/[^\d]+/g, '')) === AMEX) {
        return this.amexCardFormatter;
      } else {
        return this.defaultCardFormatter;
      }
    };

    return AdaptiveCardFormatter;

  })();

  module.exports = AdaptiveCardFormatter;

}).call(this);
