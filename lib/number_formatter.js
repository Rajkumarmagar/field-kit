// Generated by CoffeeScript 1.4.0
(function() {
  var CEILING, DOWN, FLOOR, Formatter, HALF_DOWN, HALF_EVEN, HALF_UP, NumberFormatter, UP, endsWith, incrementFormattedNumber, incrementFormattedParts, isDigits, roundCeiling, roundFloor, roundHalfEven, startsWith,
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    __slice = [].slice;

  Formatter = require('./formatter');

  CEILING = 0;

  FLOOR = 1;

  DOWN = 2;

  HALF_EVEN = 3;

  UP = 4;

  HALF_DOWN = 5;

  HALF_UP = 6;

  isDigits = function(string) {
    return /^\d*$/.test(string);
  };

  startsWith = function(prefix, string) {
    return string.slice(0, prefix.length) === prefix;
  };

  endsWith = function(suffix, string) {
    return string.slice(string.length - suffix.length) === suffix;
  };

  NumberFormatter = (function(_super) {

    __extends(NumberFormatter, _super);

    function NumberFormatter() {
      return NumberFormatter.__super__.constructor.apply(this, arguments);
    }

    NumberFormatter.prototype._allowsFloats = true;

    NumberFormatter.prototype._alwaysShowsDecimalSeparator = false;

    NumberFormatter.prototype._decimalSeparator = '.';

    NumberFormatter.prototype._groupingSeparator = ',';

    NumberFormatter.prototype._groupingSize = 3;

    NumberFormatter.prototype._maximumFractionDigits = 0;

    NumberFormatter.prototype._minimumFractionDigits = 0;

    NumberFormatter.prototype._maximumIntegerDigits = null;

    NumberFormatter.prototype._minimumIntegerDigits = 0;

    NumberFormatter.prototype._maximum = null;

    NumberFormatter.prototype._minimum = null;

    NumberFormatter.prototype._multiplier = null;

    NumberFormatter.prototype._negativeInfinitySymbol = '-∞';

    NumberFormatter.prototype._negativePrefix = '-';

    NumberFormatter.prototype._negativeSuffix = '';

    NumberFormatter.prototype._notANumberSymbol = 'NaN';

    NumberFormatter.prototype._nullSymbol = '';

    NumberFormatter.prototype._positiveInfinitySymbol = '+∞';

    NumberFormatter.prototype._positivePrefix = '';

    NumberFormatter.prototype._positiveSuffix = '';

    NumberFormatter.prototype._roundingMode = HALF_EVEN;

    NumberFormatter.prototype._usesGroupingSeparator = false;

    NumberFormatter.prototype._zeroSymbol = null;

    NumberFormatter.prototype.allowsFloats = function() {
      return this._allowsFloats;
    };

    NumberFormatter.prototype.setAllowsFloats = function(allowsFloats) {
      this._allowsFloats = allowsFloats;
      return this;
    };

    NumberFormatter.prototype.alwaysShowsDecimalSeparator = function() {
      return this._alwaysShowsDecimalSeparator;
    };

    NumberFormatter.prototype.setAlwaysShowsDecimalSeparator = function(alwaysShowsDecimalSeparator) {
      this._alwaysShowsDecimalSeparator = alwaysShowsDecimalSeparator;
      return this;
    };

    NumberFormatter.prototype.decimalSeparator = function() {
      return this._decimalSeparator;
    };

    NumberFormatter.prototype.setDecimalSeparator = function(decimalSeparator) {
      this._decimalSeparator = decimalSeparator;
      return this;
    };

    NumberFormatter.prototype.groupingSeparator = function() {
      return this._groupingSeparator;
    };

    NumberFormatter.prototype.setGroupingSeparator = function(groupingSeparator) {
      return this._groupingSeparator = groupingSeparator;
    };

    NumberFormatter.prototype.groupingSize = function() {
      return this._groupingSize;
    };

    NumberFormatter.prototype.setGroupingSize = function(groupingSize) {
      return this._groupingSize = groupingSize;
    };

    NumberFormatter.prototype.maximum = function() {
      return this._maximum;
    };

    NumberFormatter.prototype.setMaximum = function(max) {
      this._maximum = max;
      return this;
    };

    NumberFormatter.prototype.minimum = function() {
      return this._minimum;
    };

    NumberFormatter.prototype.setMinimum = function(min) {
      this._minimum = min;
      return this;
    };

    NumberFormatter.prototype.maximumFractionDigits = function() {
      return this._maximumFractionDigits;
    };

    NumberFormatter.prototype.setMaximumFractionDigits = function(maximumFractionDigits) {
      this._maximumFractionDigits = maximumFractionDigits;
      return this;
    };

    NumberFormatter.prototype.minimumFractionDigits = function() {
      return this._minimumFractionDigits;
    };

    NumberFormatter.prototype.setMinimumFractionDigits = function(minimumFractionDigits) {
      this._minimumFractionDigits = minimumFractionDigits;
      return this;
    };

    NumberFormatter.prototype.maximumIntegerDigits = function() {
      return this._maximumIntegerDigits;
    };

    NumberFormatter.prototype.setMaximumIntegerDigits = function(maximumIntegerDigits) {
      this._maximumIntegerDigits = maximumIntegerDigits;
      return this;
    };

    NumberFormatter.prototype.minimumIntegerDigits = function() {
      return this._minimumIntegerDigits;
    };

    NumberFormatter.prototype.setMinimumIntegerDigits = function(minimumIntegerDigits) {
      this._minimumIntegerDigits = minimumIntegerDigits;
      return this;
    };

    NumberFormatter.prototype.multiplier = function() {
      return this._multiplier;
    };

    NumberFormatter.prototype.setMultipler = function(multiplier) {
      this._multiplier = multiplier;
      return this;
    };

    NumberFormatter.prototype.negativeInfinitySymbol = function() {
      return this._negativeInfinitySymbol;
    };

    NumberFormatter.prototype.setNegativeInfinitySymbol = function(negativeInfinitySymbol) {
      return this._negativeInfinitySymbol = negativeInfinitySymbol;
    };

    NumberFormatter.prototype.negativePrefix = function() {
      return this._negativePrefix;
    };

    NumberFormatter.prototype.setNegativePrefix = function(prefix) {
      this._negativePrefix = prefix;
      return this;
    };

    NumberFormatter.prototype.negativeSuffix = function() {
      return this._negativeSuffix;
    };

    NumberFormatter.prototype.setNegativeSuffix = function(prefix) {
      this._negativeSuffix = prefix;
      return this;
    };

    NumberFormatter.prototype.notANumberSymbol = function() {
      return this._notANumberSymbol;
    };

    NumberFormatter.prototype.setNotANumberSymbol = function(notANumberSymbol) {
      return this._notANumberSymbol = notANumberSymbol;
    };

    NumberFormatter.prototype.nullSymbol = function() {
      return this._nullSymbol;
    };

    NumberFormatter.prototype.setNullSymbol = function(nullSymbol) {
      return this._nullSymbol = nullSymbol;
    };

    NumberFormatter.prototype.positiveInfinitySymbol = function() {
      return this._positiveInfinitySymbol;
    };

    NumberFormatter.prototype.setPositiveInfinitySymbol = function(positiveInfinitySymbol) {
      return this._positiveInfinitySymbol = positiveInfinitySymbol;
    };

    NumberFormatter.prototype.positivePrefix = function() {
      return this._positivePrefix;
    };

    NumberFormatter.prototype.setPositivePrefix = function(prefix) {
      this._positivePrefix = prefix;
      return this;
    };

    NumberFormatter.prototype.positiveSuffix = function() {
      return this._positiveSuffix;
    };

    NumberFormatter.prototype.setPositiveSuffix = function(prefix) {
      this._positiveSuffix = prefix;
      return this;
    };

    NumberFormatter.prototype.roundingMode = function() {
      return this._roundingMode;
    };

    NumberFormatter.prototype.setRoundingMode = function(roundingMode) {
      this._roundingMode = roundingMode;
      return this;
    };

    NumberFormatter.prototype.usesGroupingSeparator = function() {
      return this._usesGroupingSeparator;
    };

    NumberFormatter.prototype.setUsesGroupingSeparator = function(usesGroupingSeparator) {
      return this._usesGroupingSeparator = usesGroupingSeparator;
    };

    NumberFormatter.prototype.zeroSymbol = function() {
      return this._zeroSymbol;
    };

    NumberFormatter.prototype.setZeroSymbol = function(zeroSymbol) {
      return this._zeroSymbol = zeroSymbol;
    };

    NumberFormatter.prototype.format = function(number) {
      var copiedCharacterCount, extraFractionPart, fractionPart, i, integerPart, integerPartWithGroupingSeparators, negative, result, string, _i, _ref, _ref1, _ref2;
      if ((this._zeroSymbol != null) && number === 0) {
        return this._zeroSymbol;
      }
      if ((this._nullSymbol != null) && number === null) {
        return this._nullSymbol;
      }
      if ((this._notANumberSymbol != null) && isNaN(number)) {
        return this._notANumberSymbol;
      }
      if ((this._positiveInfinitySymbol != null) && number === Infinity) {
        return this._positiveInfinitySymbol;
      }
      if ((this._negativeInfinitySymbol != null) && number === -Infinity) {
        return this._negativeInfinitySymbol;
      }
      if (this._multiplier != null) {
        number *= this._multiplier;
      }
      negative = number < 0;
      string = "" + (Math.abs(number));
      _ref = string.split('.'), integerPart = _ref[0], fractionPart = _ref[1];
      fractionPart || (fractionPart = '');
      while (fractionPart.length < this._minimumFractionDigits) {
        fractionPart += '0';
      }
      while (integerPart.length < this._minimumIntegerDigits) {
        integerPart = '0' + integerPart;
      }
      if (fractionPart.length > this._maximumFractionDigits) {
        extraFractionPart = fractionPart.slice(this._maximumFractionDigits);
        fractionPart = fractionPart.slice(0, this._maximumFractionDigits);
        _ref1 = this._round(negative, integerPart, fractionPart, extraFractionPart), integerPart = _ref1[0], fractionPart = _ref1[1];
      }
      while (fractionPart.length > this._minimumFractionDigits && fractionPart.slice(-1) === '0') {
        fractionPart = fractionPart.slice(0, -1);
      }
      if ((this._maximumIntegerDigits != null) && integerPart.length > this._maximumIntegerDigits) {
        integerPart = integerPart.slice(-this._maximumIntegerDigits);
      }
      if (fractionPart.length > 0 || this._alwaysShowsDecimalSeparator) {
        fractionPart = this._decimalSeparator + fractionPart;
      }
      if (this._usesGroupingSeparator) {
        integerPartWithGroupingSeparators = '';
        copiedCharacterCount = 0;
        for (i = _i = _ref2 = integerPart.length - 1; _ref2 <= 0 ? _i <= 0 : _i >= 0; i = _ref2 <= 0 ? ++_i : --_i) {
          if (copiedCharacterCount > 0 && copiedCharacterCount % this._groupingSize === 0) {
            integerPartWithGroupingSeparators = this._groupingSeparator + integerPartWithGroupingSeparators;
          }
          integerPartWithGroupingSeparators = integerPart[i] + integerPartWithGroupingSeparators;
          copiedCharacterCount++;
        }
        integerPart = integerPartWithGroupingSeparators;
      }
      result = integerPart + fractionPart;
      if (negative) {
        result = this._negativePrefix + result + this._negativeSuffix;
      } else {
        result = this._positivePrefix + result + this._positiveSuffix;
      }
      return result;
    };

    NumberFormatter.prototype._round = function() {
      var args;
      args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
      return this._rounder().apply(null, args);
    };

    NumberFormatter.prototype._rounder = function() {
      switch (this._roundingMode) {
        case CEILING:
          return roundCeiling;
        case FLOOR:
          return roundFloor;
        case HALF_EVEN:
          return roundHalfEven;
      }
    };

    NumberFormatter.prototype.parse = function(string, error) {
      var result;
      if ((this._zeroSymbol != null) && string === this._zeroSymbol) {
        return 0;
      }
      if ((this._nullSymbol != null) && string === this._nullSymbol) {
        return null;
      }
      if ((this._notANumberSymbol != null) && string === this._notANumberSymbol) {
        return NaN;
      }
      if ((this._positiveInfinitySymbol != null) && string === this._positiveInfinitySymbol) {
        return Infinity;
      }
      if ((this._negativeInfinitySymbol != null) && string === this._negativeInfinitySymbol) {
        return -Infinity;
      }
      if (startsWith(this._negativePrefix, string) && endsWith(this._negativeSuffix, string)) {
        result = this._parseAbsoluteValue(string.slice(this._negativePrefix.length, string.length - this._negativeSuffix.length), error);
        if (result != null) {
          result *= -1;
        }
        return result;
      } else if (startsWith(this._positivePrefix, string) && endsWith(this._positiveSuffix, string)) {
        return this._parseAbsoluteValue(string.slice(this._positivePrefix.length, string.length - this._positiveSuffix.length), error);
      } else {
        if (typeof error === "function") {
          error('number-formatter.invalid-format');
        }
        return null;
      }
    };

    NumberFormatter.prototype._parseAbsoluteValue = function(string, error) {
      var fractionPart, integerPart, number, parts;
      parts = string.split(this._decimalSeparator);
      if (parts.length > 2) {
        if (typeof error === "function") {
          error('number-formatter.invalid-format');
        }
        return null;
      }
      integerPart = parts[0];
      fractionPart = parts[1] || '';
      if (!isDigits(integerPart) || !isDigits(fractionPart)) {
        if (typeof error === "function") {
          error('number-formatter.invalid-format');
        }
        return null;
      }
      number = Number(integerPart) + Number("." + (fractionPart || '0'));
      if (!this._allowsFloats && number !== ~~number) {
        if (typeof error === "function") {
          error('number-formatter.floats-not-allowed');
        }
        return null;
      }
      if ((this._minimum != null) && number < this._minimum) {
        if (typeof error === "function") {
          error('number-formatter.out-of-bounds.below-minimum');
        }
        return null;
      }
      if ((this._maximum != null) && number > this._maximum) {
        if (typeof error === "function") {
          error('number-formatter.out-of-bounds.above-maximum');
        }
        return null;
      }
      if (this._multiplier != null) {
        number /= this._multiplier;
      }
      return number;
    };

    return NumberFormatter;

  })(Formatter);

  NumberFormatter.prototype.stringFromNumber = NumberFormatter.prototype.format;

  NumberFormatter.prototype.numberFromString = NumberFormatter.prototype.parse;

  NumberFormatter.prototype.minusSign = NumberFormatter.prototype.negativePrefix;

  NumberFormatter.prototype.setMinusSign = NumberFormatter.prototype.setNegativePrefix;

  roundCeiling = function(negative, integerPart, fractionPart, extraFractionPart) {
    var _ref;
    if (negative) {
      return roundFloor(!negative, integerPart, fractionPart, extraFractionPart);
    }
    if (/[1-9]/.test(extraFractionPart)) {
      _ref = incrementFormattedParts(integerPart, fractionPart), integerPart = _ref[0], fractionPart = _ref[1];
    }
    return [integerPart, fractionPart];
  };

  roundFloor = function(negative, integerPart, fractionPart, extraFractionPart) {
    if (negative) {
      return roundCeiling(!negative, integerPart, fractionPart, extraFractionPart);
    }
    return [integerPart, fractionPart];
  };

  roundHalfEven = function(negative, integerPart, fractionPart, extraFractionPart) {
    var lastDigit, rounder;
    switch (extraFractionPart[0]) {
      case '1':
      case '2':
      case '3':
      case '4':
        rounder = roundFloor;
        break;
      case '5':
        lastDigit = (fractionPart.length === 0 ? integerPart : fractionPart).slice(-1);
        rounder = (Number(lastDigit) % 2 === 0) ^ negative ? roundFloor : roundCeiling;
        break;
      default:
        rounder = roundCeiling;
    }
    return rounder(negative, integerPart, fractionPart, extraFractionPart);
  };

  incrementFormattedParts = function(integerPart, fractionPart) {
    var fractionCarryOver, integerCarryOver, _ref, _ref1;
    _ref = incrementFormattedNumber(fractionPart), fractionCarryOver = _ref[0], fractionPart = _ref[1];
    while (fractionCarryOver--) {
      _ref1 = incrementFormattedNumber(integerPart), integerCarryOver = _ref1[0], integerPart = _ref1[1];
      if (integerCarryOver) {
        integerPart = integerCarryOver + integerPart;
      }
    }
    return [integerPart, fractionPart];
  };

  incrementFormattedNumber = function(string) {
    var number;
    string = "1" + string;
    number = Number(string) + 1;
    string = "" + number;
    switch (string[0]) {
      case '1':
        return [0, string.slice(1)];
      case '2':
        return [1, string.slice(1)];
      default:
        throw new Error("unexpected carry over value '" + string[0] + "', expected '1' or '2'");
    }
  };

  NumberFormatter.Rounding = {
    CEILING: CEILING,
    FLOOR: FLOOR,
    DOWN: DOWN,
    HALF_EVEN: HALF_EVEN,
    UP: UP,
    HALF_DOWN: HALF_DOWN,
    HALF_UP: HALF_UP
  };

  module.exports = NumberFormatter;

}).call(this);
