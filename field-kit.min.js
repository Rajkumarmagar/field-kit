(function(){function e(t,n){for(var r=[],i=t.split("/"),s,o,u=0;o=i[u++];)".."==o?r.pop():"."!=o&&r.push(o);r=r.join("/"),u=e,o=u.m[n||0],s=o[r+".js"]||o[r+"/index.js"]||o[r];if(o=s.c)s=u.m[n=o][t=s.m];return s.exports||s(s,s.exports={},function(e){return u("."!=e.charAt(0)?e:t+"/../"+e,n)}),s.exports}e.m=[],e.m[0]={"adaptive_card_formatter.js":function(e,t,n){(function(){var t,r,i,s,o,u,a,f;i=n("./amex_card_formatter"),o=n("./default_card_formatter"),t="amex",s="discover",u="mastercard",a="visa",f=function(e){var n,r,i;if(e==null)return null;e=e.toString(),n=parseInt(e.slice(0,2),10),i=parseInt(e.slice(0,6),10),r=parseInt(e.slice(0,3),10);if(e[0]==="4")return a;if(e.slice(0,4)==="6011"||n===65||r>=664&&r<=649||i>=622126&&i<=622925)return s;if(n>=51&&n<=55)return u;if(n===34||n===37)return t},r=function(){function e(){this.amexCardFormatter=new i,this.defaultCardFormatter=new o,this.formatter=this.defaultCardFormatter}return e.prototype.format=function(e){return this.formatter.format(e)},e.prototype.parse=function(e){return this.formatter.parse(e)},e.prototype.isChangeValid=function(e){return f(e.proposed.text.replace(/[^\d]+/g,""))===t?this.formatter=this.amexCardFormatter:this.formatter=this.defaultCardFormatter,this.formatter.isChangeValid(e)},e}(),e.exports=r}).call(this)},"amex_card_formatter.js":function(e,t,n){(function(){var t,r,i={}.hasOwnProperty,s=function(e,t){function r(){this.constructor=e}for(var n in t)i.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};r=n("./default_card_formatter"),t=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return s(t,e),t.prototype.maximumLength=17,t.prototype.hasDelimiterAtIndex=function(e){return e===4||e===11},t}(r),e.exports=t}).call(this)},"card_field.js":function(e,t,n){(function(){var t,r,i,s,o,u,a,f,l,c=function(e,t){return function(){return e.apply(t,arguments)}},h=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},p={}.hasOwnProperty,d=function(e,t){function r(){this.constructor=e}for(var n in t)p.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};f='<div class="card-field">\n  <div class="card-field-inner">\n    <input class="card-field-pan" placeholder="1234 5678 9012 3456"/>\n    <div class="card-field-extras">\n      <input class="card-field-expiry" placeholder="MM/YY"/><!--\n   --><input class="card-field-cvv" placeholder="CCV"/><!--\n   --><input class="card-field-postal-code" placeholder="ZIP"/>\n    </div>\n  </div>\n</div>',a={A:65,ZERO:48,NINE:57,LEFT:37,RIGHT:39,UP:38,DOWN:40,BACKSPACE:8,DELETE:46},a.isDigit=function(e){return this.ZERO<=e&&e<=this.NINE},a.isDirectional=function(e){return e===this.LEFT||e===this.RIGHT||e===this.UP||e===this.DOWN},u=" ",l=function(e){return e.replace(/\s+/g,"")},o=n("./text_field"),r=function(){function e(e,t){this.cardField=e,this.element=t,this.keyUp=c(this.keyUp,this),this.keyDown=c(this.keyDown,this),this.element.on("keydown",this.keyDown),this.element.on("keyup",this.keyUp)}return e.prototype.keyDown=function(e){var t;if(e.metaKey||e.ctrlKey)return;if(a.isDirectional(e.keyCode))return;if(a.isDigit(e.keyCode)&&!e.shiftKey&&!e.altKey)return this.alignCenter();if(e.keyCode===a.DELETE){t=this.element.caret();if(t.start===0&&t.end===this.element.val().length)return this.alignLeft();if(this.element.val().length===1&&t.start===t.end&&t.start===0)return this.alignLeft()}else{if(e.keyCode!==a.BACKSPACE)return e.preventDefault();t=this.element.caret();if(t.start===0&&t.end===this.element.val().length)return this.alignLeft();if(this.element.val().length===1&&t.start===t.end&&t.start===1)return this.alignLeft()}},e.prototype.keyUp=function(e){},e.prototype.alignCenter=function(){return this.element.css("text-align","center")},e.prototype.alignLeft=function(){return this.element.css("text-align","left")},e}(),s=function(){function e(){}return e.GAP_INDEXES=[3,7,11],e.prototype.length=16,e.prototype.format=function(e){var t,n,r,i;e=l(e).substring(0,this.length),n="";for(t=r=0,i=e.length;0<=i?r<i:r>i;t=0<=i?++r:--r)n+=e[t],h.call(this.constructor.GAP_INDEXES,t)>=0&&(n+=u);return n},e.prototype.parse=function(e){return l(e)},e}(),t=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return d(t,e),t.GAP_INDEXES=[3,9],t.prototype.length=15,t}(s),i=function(){function e(){this.onPanChanged=c(this.onPanChanged,this)}return e.prototype.getElement=function(){return this._element||this.build()},e.prototype.build=function(){return this._element=$(f),this._panField=new PanField(this,this._element.find(".card-field-pan")),this._panField.on("change",this.onPanChanged),this._panField.formatter=new s,this._expiryField=new r(this,this._element.find(".card-field-expiry")),this._cvvField=new r(this,this._element.find(".card-field-cvv")),this._postalField=new r(this,this._element.find(".card-field-postal-code")),this._element},e.prototype.onPanChanged=function(){return this.cardType=Juno.determineCardType(this._panField.value)},e.prototype.__defineGetter__("cardType",function(){return this._cardType}),e.prototype.__defineSetter__("cardType",function(e){if(e===this._cardType)return;return this._cardType&&this._element.removeClass("card-field-"+this._cardType),e&&this._element.addClass("card-field-"+e),this._cardType=e,e===Juno.CardType.AMEX?this._panField.formatter=new t:this._panField.formatter=new s}),e}(),typeof e!="undefined"&&e!==null?e.exports=i:typeof window!="undefined"&&window!==null&&(window.CardField=i)}).call(this)},"default_card_formatter.js":function(e,t,n){(function(){var t,r,i={}.hasOwnProperty,s=function(e,t){function r(){this.constructor=e}for(var n in t)i.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};r=n("./delimited_text_formatter"),t=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return s(t,e),t.prototype.delimiter=" ",t.prototype.maximumLength=19,t.prototype.hasDelimiterAtIndex=function(e){return e===4||e===9||e===14},t.prototype.parse=function(e){return t.__super__.parse.call(this,(e!=null?e:"").replace(/[^\d]/g,""))},t}(r),e.exports=t}).call(this)},"delimited_text_formatter.js":function(e,t,n){(function(){var t,r,i={}.hasOwnProperty,s=function(e,t){function r(){this.constructor=e}for(var n in t)i.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};r=n("./formatter"),t=function(e){function t(e){var t;e==null&&(e=this.delimiter),this.delimiter=e;if(((t=this.delimiter)!=null?t.length:void 0)!==1)throw new Error("delimiter must have just one character")}return s(t,e),t.prototype.delimiter=null,t.prototype.format=function(e){var t,n,r,i;if(!e)return"";n="";for(r=0,i=e.length;r<i;r++)t=e[r],this.hasDelimiterAtIndex(n.length)&&(n+=this.delimiter),n+=t,this.hasDelimiterAtIndex(n.length)&&(n+=this.delimiter);return n},t.prototype.parse=function(e){var t;return e?function(){var n,r,i;i=[];for(n=0,r=e.length;n<r;n++)t=e[n],t!==this.delimiter&&i.push(t);return i}.call(this).join(""):null},t.prototype.isChangeValid=function(e){var n,r,i,s,o;return t.__super__.isChangeValid.call(this,e)?(s=e.proposed.text,e.deleted.text===this.delimiter&&(s=s.substring(0,s.length-1)),n=e.proposed.caret,i=n.start!==n.end,o=n.start<e.current.caret.start,r=n.end<e.current.caret.end,this.hasDelimiterAtIndex(n.start)&&(o?n.start--:n.start++),i?this.hasDelimiterAtIndex(n.end-1)&&(o||r?n.end--:n.end++):n.end=n.start,s=this.format(this.parse(s)),e.proposed.text=s,!0):!1},t}(r),e.exports=t}).call(this)},"expiry_date_formatter.js":function(e,t,n){(function(){var t,r,i,s={}.hasOwnProperty,o=function(e,t){function r(){this.constructor=e}for(var n in t)s.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=n("./delimited_text_formatter"),i=function(e){var t;t=""+e;while(t.length<2)t="0"+t;return t},r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return o(t,e),t.prototype.delimiter="/",t.prototype.maximumLength=5,t.prototype.hasDelimiterAtIndex=function(e){return e===2},t.prototype.format=function(e){var n,r;return e?(n=e.month,r=e.year,r%=10,t.__super__.format.call(this,i(n)+i(r))):""},t.prototype.parse=function(e){var n;e=t.__super__.parse.call(this,e);if(n=e.match(/^(0?[1-9]|1\d)(\d\d)$/))return{month:Number(n[1]),year:Number(n[2])}},t.prototype.isChangeValid=function(e){var t,n,r;t=e.proposed.text.length<e.current.text.length,r=e.proposed.text;if(t)e.deleted.text===this.delimiter&&(r=r[0]),r==="0"&&(r="");else if(e.inserted.text===this.delimiter&&e.current.text==="1")r="01"+this.delimiter;else{if(!/^\d$/.test(e.inserted.text))return!1;/^[2-9]$/.test(r)&&(r="0"+r);if(/^1[3-9]$/.test(r))return!1;if(r==="00")return!1;/^(0[1-9]|1[0-2])$/.test(r)&&(r+=this.delimiter),(n=r.match(/^(\d\d)(.)(\d\d?).*$/))&&n[2]===this.delimiter&&(r=n[1]+this.delimiter+n[3])}return e.proposed.text=r,e.proposed.caret={start:r.length,end:r.length},!0},t}(t),e.exports=r}).call(this)},"formatter.js":function(e,t,n){(function(){var t;t=function(){function e(){}return e.prototype.maximumLength=null,e.prototype.format=function(e){return e==null&&(e=""),this.maximumLength!=null&&(e=e.substring(0,this.maximumLength)),e},e.prototype.parse=function(e){return e==null&&(e=""),this.maximumLength!=null&&(e=e.substring(0,this.maximumLength)),e},e.prototype.isChangeValid=function(e){var t,n,r,i,s,o;return o=e.proposed,n=o.caret,i=o.text,this.maximumLength!=null&&i.length>this.maximumLength&&(t=this.maximumLength-(i.length-e.inserted.text.length),r=e.current.text.substring(0,e.current.caret.start),t>0&&(r+=e.inserted.text.substring(0,t)),r+=e.current.text.substring(e.current.caret.end),s=i.length-r.length,e.proposed.text=r,n.start-=s,n.end-=s),!0},e}(),e.exports=t}).call(this)},"index.js":function(e,t,n){(function(){var t;t={AdaptiveCardFormatter:n("./adaptive_card_formatter"),DefaultCardFormatter:n("./default_card_formatter"),AmexCardFormatter:n("./amex_card_formatter"),ExpiryDateFormatter:n("./expiry_date_formatter"),Formatter:n("./formatter"),SocialSecurityNumberFormatter:n("./social_security_number_formatter"),DelimitedTextFormatter:n("./delimited_text_formatter"),TextField:n("./text_field")},e.exports=t}).call(this)},"social_security_number_formatter.js":function(e,t,n){(function(){var t,r,i={}.hasOwnProperty,s=function(e,t){function r(){this.constructor=e}for(var n in t)i.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=n("./delimited_text_formatter"),r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return s(t,e),t.prototype.delimiter="-",t.prototype.maximumLength=11,t.prototype.hasDelimiterAtIndex=function(e){return e===3||e===6},t.prototype.isChangeValid=function(e){return/^\d*$/.test(e.inserted.text)?t.__super__.isChangeValid.call(this,e):!1},t}(t),e.exports=r}).call(this)},"text_field.js":function(e,t,n){(function(){var t,n,r,i,s,o,u,a,f=function(e,t){return function(){return e.apply(t,arguments)}},l=[].slice;n={A:65,ZERO:48,NINE:57,LEFT:37,RIGHT:39,UP:38,DOWN:40,BACKSPACE:8,DELETE:46,TAB:9},n.isDigit=function(e){return this.ZERO<=e&&e<=this.NINE},n.isDirectional=function(e){return e===this.LEFT||e===this.RIGHT||e===this.UP||e===this.DOWN},t={UPSTREAM:0,DOWNSTREAM:1,NONE:null},u=function(e){return e&&/^\w$/.test(e)},i='*[name(.)="input" or name(.)="select"][not(type="hidden")][not(contains(@class, "formatted-text-field-interceptor"))]',s=function(e){var t;return t=document.evaluate("following::"+i,e,null,XPathResult.ANY_TYPE,null),t.iterateNext()},o=function(e){var t;return t=document.evaluate("preceding::"+i,e,null,XPathResult.ANY_TYPE,null),t.iterateNext()},a=function(e,t){var n;return(n=$(e).data("formatted-text-field"))?n.becomeFirstResponder(t):(typeof e.focus=="function"&&e.focus(),typeof e.select=="function"?e.select():void 0)},r=function(){function e(e){this.element=e,this.click=f(this.click,this),this.paste=f(this.paste,this),this.keyUp=f(this.keyUp,this),this.keyPress=f(this.keyPress,this),this.keyDown=f(this.keyDown,this),this.afterInterceptorKeyUp=f(this.afterInterceptorKeyUp,this),this.beforeInterceptorKeyUp=f(this.beforeInterceptorKeyUp,this),this.element.on("keydown",this.keyDown),this.element.on("keypress",this.keyPress),this.element.on("keyup",this.keyUp),this.element.on("click",this.click),this.element.on("paste",this.paste),this.element.data("formatted-text-field",this),this.createTabInterceptors()}return e.prototype.selectionAffinity=t.NONE,e.prototype.createTabInterceptors=function(){var e,t,n,r;return r=this.element.get(0),n=function(){var e;return e=r.ownerDocument.createElement("input"),e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.opacity=0,e.style.zIndex=-9999,e.style.pointerEvents="none",e.className="formatted-text-field-interceptor",e},t=n(),t.onkeyup=this.beforeInterceptorKeyUp,r.parentNode.insertBefore(t,r),e=n(),e.onkeyup=this.afterInterceptorKeyUp,r.nextSibling?r.parentNode.insertBefore(e,r.nextSibling):r.parentNode.appendChild(e)},e.prototype.beforeInterceptorKeyUp=function(e){var t;if(e.keyCode===n.TAB&&e.shiftKey)if(t=o(e.target))return a(t)},e.prototype.afterInterceptorKeyUp=function(e){var t;if(e.keyCode===n.TAB&&!e.shiftKey)if(t=s(e.target))return a(t)},e.prototype.insertCharacter=function(e){var t;e.preventDefault(),this.hasSelection&&this.clearSelection();if(this.formatter.length&&this.text.length>=this.formatter.length)return;return this.replaceSelection(String.fromCharCode(e.charCode)),t=this.selectedRange,t.start+=t.length,t.length=0,this.setSelectedRange(t)},e.prototype.moveUp=function(e){return e.preventDefault(),this.setSelectedRange({start:0,length:0})},e.prototype.moveToBeginningOfParagraph=function(e){return this.moveUp(e)},e.prototype.moveUpAndModifySelection=function(e){var n;e.preventDefault(),n=this.selectedRange;switch(this.selectionAffinity){case t.UPSTREAM:case t.NONE:n.length+=n.start,n.start=0;break;case t.DOWNSTREAM:n.length=n.start,n.start=0}return this.setSelectedRangeWithAffinity(n,t.UPSTREAM)},e.prototype.moveParagraphBackwardAndModifySelection=function(e){var n;e.preventDefault(),n=this.selectedRange;switch(this.selectionAffinity){case t.UPSTREAM:case t.NONE:n.length+=n.start,n.start=0;break;case t.DOWNSTREAM:n.length=0}return this.setSelectedRangeWithAffinity(n,t.UPSTREAM)},e.prototype.moveToBeginningOfDocument=function(e){return this.moveToBeginningOfLine(e)},e.prototype.moveToBeginningOfDocumentAndModifySelection=function(e){var n;return e.preventDefault(),n=this.selectedRange,n.length+=n.start,n.start=0,this.setSelectedRangeWithAffinity(n,t.UPSTREAM)},e.prototype.moveDown=function(e){var n;return e.preventDefault(),n={start:this.text.length,length:0},this.setSelectedRangeWithAffinity(n,t.NONE)},e.prototype.moveToEndOfParagraph=function(e){return this.moveDown(e)},e.prototype.moveDownAndModifySelection=function(e){var n,r;return e.preventDefault(),r=this.selectedRange,n=this.text.length,this.selectionAffinity===t.UPSTREAM&&(r.start+=r.length),r.length=n-r.start,this.setSelectedRangeWithAffinity(r,t.DOWNSTREAM)},e.prototype.moveParagraphForwardAndModifySelection=function(e){var n;e.preventDefault(),n=this.selectedRange;switch(this.selectionAffinity){case t.DOWNSTREAM:case t.NONE:n.length=this.text.length-n.start;break;case t.UPSTREAM:n.start+=n.length,n.length=0}return this.setSelectedRangeWithAffinity(n,t.DOWNSTREAM)},e.prototype.moveToEndOfDocument=function(e){return this.moveToEndOfLine(e)},e.prototype.moveToEndOfDocumentAndModifySelection=function(e){var n;return e.preventDefault(),n=this.selectedRange,n.length=this.text.length-n.start,this.setSelectedRangeWithAffinity(n,t.DOWNSTREAM)},e.prototype.moveLeft=function(e){var n;return e.preventDefault(),n=this.selectedRange,n.length!==0?n.length=0:n.start--,this.setSelectedRangeWithAffinity(n,t.NONE)},e.prototype.moveLeftAndModifySelection=function(e){var n;e.preventDefault(),n=this.selectedRange;switch(this.selectionAffinity){case t.UPSTREAM:case t.NONE:this.selectionAffinity=t.UPSTREAM,n.start--,n.length++;break;case t.DOWNSTREAM:n.length--}return this.setSelectedRange(n)},e.prototype.moveWordLeft=function(e){var t;return e.preventDefault(),t=this.lastWordBreakBeforeIndex(this.selectedRange.start-1),this.setSelectedRange({start:t,length:0})},e.prototype.moveWordLeftAndModifySelection=function(e){var n,r,i;e.preventDefault(),r=this.selectedRange;switch(this.selectionAffinity){case t.UPSTREAM:case t.NONE:this.selectionAffinity=t.UPSTREAM,i=this.lastWordBreakBeforeIndex(r.start-1),r.length+=r.start-i,r.start=i;break;case t.DOWNSTREAM:n=this.lastWordBreakBeforeIndex(r.start+r.length),n<r.start&&(n=r.start),r.length-=r.start+r.length-n}return this.setSelectedRange(r)},e.prototype.moveToBeginningOfLine=function(e){return e.preventDefault(),this.setSelectedRange({start:0,length:0})},e.prototype.moveToBeginningOfLineAndModifySelection=function(e){var n;return e.preventDefault(),n=this.selectedRange,n.length+=n.start,n.start=0,this.setSelectedRangeWithAffinity(n,t.UPSTREAM)},e.prototype.moveRight=function(e){var n;return e.preventDefault(),n=this.selectedRange,n.length!==0?(n.start+=n.length,n.length=0):n.start++,this.setSelectedRangeWithAffinity(n,t.NONE)},e.prototype.moveRightAndModifySelection=function(e){var n;e.preventDefault(),n=this.selectedRange;switch(this.selectionAffinity){case t.UPSTREAM:n.start++,n.length--;break;case t.DOWNSTREAM:case t.NONE:this.selectionAffinity=t.DOWNSTREAM,n.length++}return this.setSelectedRange(n)},e.prototype.moveWordRight=function(e){var t,n;return e.preventDefault(),n=this.selectedRange,t=this.nextWordBreakAfterIndex(n.start+n.length),this.setSelectedRange({start:t,length:0})},e.prototype.moveWordRightAndModifySelection=function(e){var n,r,i;e.preventDefault(),r=this.selectedRange,i=r.start,n=r.start+r.length;switch(this.selectionAffinity){case t.UPSTREAM:i=Math.min(this.nextWordBreakAfterIndex(i),n);break;case t.DOWNSTREAM:case t.NONE:this.selectionAffinity=t.DOWNSTREAM,n=this.nextWordBreakAfterIndex(r.start+r.length)}return this.setSelectedRange({start:i,length:n-i})},e.prototype.moveToEndOfLine=function(e){var t;return e.preventDefault(),t=this.text,this.setSelectedRange({start:this.text.length,length:0})},e.prototype.moveToEndOfLineAndModifySelection=function(e){var n;return e.preventDefault(),n=this.selectedRange,n.length=this.text.length-n.start,this.setSelectedRangeWithAffinity(n,t.DOWNSTREAM)},e.prototype.deleteBackward=function(e){var t;return e.preventDefault(),t=this.selectedRange,t.length===0&&(t.start--,t.length++,this.setSelectedRange(t)),this.clearSelection()},e.prototype.deleteWordBackward=function(e){var t,n;return this.hasSelection?this.deleteBackward(e):(e.preventDefault(),t=this.selectedRange,n=this.lastWordBreakBeforeIndex(t.start),t.length+=t.start-n,t.start=n,this.setSelectedRange(t),this.clearSelection())},e.prototype.deleteBackwardByDecomposingPreviousCharacter=function(e){return this.deleteBackward(e)},e.prototype.deleteBackwardToBeginningOfLine=function(e){var t;return this.hasSelection?this.deleteBackward(e):(e.preventDefault(),t=this.selectedRange,t.length=t.start,t.start=0,this.setSelectedRange(t),this.clearSelection())},e.prototype.deleteForward=function(e){var t;return e.preventDefault(),t=this.selectedRange,t.length===0&&(t.length++,this.setSelectedRange(t)),this.clearSelection()},e.prototype.deleteWordForward=function(e){var t,n;return this.hasSelection?this.deleteForward(e):(e.preventDefault(),n=this.selectedRange,t=this.nextWordBreakAfterIndex(n.start+n.length),this.setSelectedRange({start:n.start,length:t-n.start}),this.clearSelection())},e.prototype.insertTab=function(e){},e.prototype.insertBackTab=function(e){},e.prototype.becomeFirstResponder=function(e){var t=this;return this.element.focus(),this.rollbackInvalidChanges(function(){return t.element.select()})},e.prototype.resignFirstResponder=function(e){return e.preventDefault(),this.element.blur(),$("#no-selection-test").focus()},e.prototype.__defineGetter__("hasSelection",function(){return this.selectedRange.length!==0}),e.prototype.lastWordBreakBeforeIndex=function(e){var t,n,r,i,s;t=this.leftWordBreakIndexes,n=t[0];for(i=0,s=t.length;i<s;i++){r=t[i];if(!(e>r))break;n=r}return n},e.prototype.__defineGetter__("leftWordBreakIndexes",function(){var e,t,n,r,i;t=[],n=this.text;for(e=r=0,i=n.length-1;0<=i?r<=i:r>=i;e=0<=i?++r:--r)!u(n[e-1])&&u(n[e])&&t.push(e);return t}),e.prototype.nextWordBreakAfterIndex=function(e){var t,n,r,i,s;t=this.rightWordBreakIndexes.reverse(),n=t[0];for(i=0,s=t.length;i<s;i++){r=t[i];if(!(e<r))break;n=r}return n},e.prototype.__defineGetter__("rightWordBreakIndexes",function(){var e,t,n,r,i;t=[],n=this.text;for(e=r=0,i=n.length-1;0<=i?r<=i:r>=i;e=0<=i?++r:--r)u(n[e])&&!u(n[e+1])&&t.push(e+1);return t}),e.prototype.clearSelection=function(){return this.replaceSelection("")},e.prototype.replaceSelection=function(e){var n,r,i;return r=this.selectedRange,n=r.start+r.length,i=this.text,i=i.substring(0,r.start)+e+i.substring(n),r.length=e.length,this.text=i,this.setSelectedRangeWithAffinity(r,t.NONE)},e.prototype.selectAll=function(e){return e.preventDefault(),this.setSelectedRangeWithAffinity({start:0,length:this.text.length},t.NONE)},e.prototype.readSelectionFromPasteboard=function(e){var t,n;return n=e.getData("Text"),this.replaceSelection(n),t=this.selectedRange,t.start+=t.length,t.length=0,this.setSelectedRange(t)},e.prototype.keyDown=function(e){var t=this;return this.rollbackInvalidChanges(function(){var r,i,s,o,u,a;s=e.keyCode,o=e.metaKey,i=e.ctrlKey,a=e.shiftKey,r=e.altKey,u=[],r&&u.push("alt"),i&&u.push("ctrl"),o&&u.push("meta"),a&&u.push("shift"),u=u.join("+");if((o||i)&&s===n.A)t.selectAll(e);else if(s===n.LEFT)switch(u){case"":t.moveLeft(e);break;case"alt":t.moveWordLeft(e);break;case"shift":t.moveLeftAndModifySelection(e);break;case"alt+shift":t.moveWordLeftAndModifySelection(e);break;case"meta":t.moveToBeginningOfLine(e);break;case"meta+shift":t.moveToBeginningOfLineAndModifySelection(e);break;default:throw new Error("unhandled left+"+u)}else if(s===n.RIGHT)switch(u){case"":t.moveRight(e);break;case"alt":t.moveWordRight(e);break;case"shift":t.moveRightAndModifySelection(e);break;case"alt+shift":t.moveWordRightAndModifySelection(e);break;case"meta":t.moveToEndOfLine(e);break;case"meta+shift":t.moveToEndOfLineAndModifySelection(e);break;default:throw new Error("unhandled right+"+u)}else if(s===n.UP)switch(u){case"":t.moveUp(e);break;case"alt":t.moveToBeginningOfParagraph(e);break;case"shift":t.moveUpAndModifySelection(e);break;case"alt+shift":t.moveParagraphBackwardAndModifySelection(e);break;case"meta":t.moveToBeginningOfDocument(e);break;case"meta+shift":t.moveToBeginningOfDocumentAndModifySelection(e);break;default:throw new Error("unhandled up+"+u)}else if(s===n.DOWN)switch(u){case"":t.moveDown(e);break;case"alt":t.moveToEndOfParagraph(e);break;case"shift":t.moveDownAndModifySelection(e);break;case"alt+shift":t.moveParagraphForwardAndModifySelection(e);break;case"meta":t.moveToEndOfDocument(e);break;case"meta+shift":t.moveToEndOfDocumentAndModifySelection(e);break;default:throw new Error("unhandled down+"+u)}else if(s===n.BACKSPACE)switch(u){case"":t.deleteBackward(e);break;case"alt":case"alt+shift":t.deleteWordBackward(e);break;case"ctrl":case"ctrl+shift":t.deleteBackwardByDecomposingPreviousCharacter(e);break;case"meta":case"meta+shift":t.deleteBackwardToBeginningOfLine(e);break;default:throw new Error("unhandled backspace+"+u)}else s===n.DELETE?r?t.deleteWordForward(e):t.deleteForward(e):s===n.TAB&&(a?t.insertBackTab(e):t.insertTab(e));return null})},e.prototype.keyPress=function(e){var t=this;return this.rollbackInvalidChanges(function(){return t.insertCharacter(e)})},e.prototype.keyUp=function(e){var t=this;return this.rollbackInvalidChanges(function(){if(e.keyCode===n.TAB)return t.selectAll(e)})},e.prototype.paste=function(e){var t=this;return e.preventDefault(),this.rollbackInvalidChanges(function(){return t.readSelectionFromPasteboard(e.originalEvent.clipboardData)})},e.prototype.rollbackInvalidChanges=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d;t={field:this,current:{caret:this.caret,text:this.text}},a=e(),t.proposed={caret:this.caret,text:this.text};if(t.proposed.text!==t.current.text){n=t.current.text,u=t.proposed.text,f=0,l=0,o=Math.min(n.length,u.length);for(i=c=0;0<=o?c<o:c>o;i=0<=o?++c:--c){if(u[i]!==n[i])break;f=i+1}for(i=h=0,p=o-f;0<=p?h<p:h>p;i=0<=p?++h:--h){if(u[u.length-1-i]!==n[n.length-1-i])break;l=i+1}s={start:f,end:u.length-l},r={start:f,end:n.length-l},s.text=u.substring(s.start,s.end),r.text=n.substring(r.start,r.end),t.inserted=s,t.deleted=r}else t.inserted={start:t.proposed.caret.start,end:t.proposed.caret.end,text:""},t.deleted={start:t.current.caret.start,end:t.current.caret.end,text:""};return typeof ((d=this.formatter)!=null?d.isChangeValid:void 0)=="function"&&(this.formatter.isChangeValid(t)?(this.text=t.proposed.text,this.caret=t.proposed.caret):(this.text=t.current.text,this.caret=t.current.caret)),a},e.prototype.click=function(e){return this.selectionAffinity=t.NONE},e.prototype.on=function(){var e,t;return e=1<=arguments.length?l.call(arguments,0):[],(t=this.element).on.apply(t,e)},e.prototype.off=function(){var e,t;return e=1<=arguments.length?l.call(arguments,0):[],(t=this.element).off.apply(t,e)},e.prototype.__defineGetter__("text",function(){return this.element.val()}),e.prototype.__defineSetter__("text",function(e){return this.element.val(e)}),e.prototype.__defineGetter__("value",function(){var e;return e=this.element.val(),this._formatter?this._formatter.parse(e):e}),e.prototype.__defineSetter__("value",function(e){return this._formatter&&(e=this._formatter.format(e)),this.element.val(""+e),this.element.trigger("change")}),e.prototype.__defineGetter__("formatter",function(){return this._formatter}),e.prototype.__defineSetter__("formatter",function(e){var t;return t=this.value,this._formatter=e,this.value=t}),e.prototype.__defineGetter__("caret",function(){var e,t,n;return n=this.element.caret(),t=n.start,e=n.end,{start:t,end:e}}),e.prototype.__defineGetter__("selectedRange",function(){var e;return e=this.caret,{start:e.start,length:e.end-e.start}}),e.prototype.__defineSetter__("caret",function(e){var n,r;r=0,n=this.text.length,e={start:Math.max(r,Math.min(n,e.start)),end:Math.max(r,Math.min(n,e.end))},this.element.caret(e);if(e.start===e.end)return this.selectionAffinity=t.NONE}),e.prototype.setSelectedRange=function(e){return this.setSelectedRangeWithAffinity(e,this.selectionAffinity)},e.prototype.setSelectedRangeWithAffinity=function(e,t){return this.selectionAffinity=t,this.caret={start:e.start,end:e.start+e.length}},e.prototype.__defineGetter__("selectionAnchor",function(){var e;e=this.selectedRange;switch(this.selectionAffinity){case t.UPSTREAM:return e.start+e.length;case t.DOWNSTREAM:return e.start;default:return null}}),e}(),e.exports=r}).call(this)}},FieldKit=e("index.js")})();