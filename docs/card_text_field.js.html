<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: card_text_field.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: card_text_field.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*! jshint esnext:true, undef:true, unused:true */

import TextField from './text_field';
import AdaptiveCardFormatter from './adaptive_card_formatter';
import { determineCardType } from './card_utils';

/**
 * Enum for card mask strategies.
 *
 * @readonly
 * @enum {number}
 * @private
 */
var CardMaskStrategy = {
  None: 'None',
  DoneEditing: 'DoneEditing'
};

/**
 * CardTextField add some functionality for credit card inputs
 *
 * @extends TextField
 */
class CardTextField extends TextField {
  /**
   * @param {HTMLElement} element
   */
  constructor(element) {
    super(element, new AdaptiveCardFormatter());
    this.setCardMaskStrategy(CardMaskStrategy.None);

    /**
     * Whether we are currently masking the displayed text.
     *
     * @private
     */
    this._masked = false;

    /**
     * Whether we are currently editing.
     *
     * @private
     */
    this._editing = false;
  }

  /**
   * Gets the card type for the current value.
   *
   * @returns {string} Returns one of 'visa', 'mastercard', 'amex' and 'discover'.
   */
  cardType() {
    return determineCardType(this.value());
  }

  /**
   * Gets the type of masking this field uses.
   *
   * @returns {CardMaskStrategy}
   */
  cardMaskStrategy() {
    return this._cardMaskStrategy;
  }

  /**
   * Sets the type of masking this field uses.
   *
   * @param {CardMaskStrategy} cardMaskStrategy One of CardMaskStrategy.
   */
  setCardMaskStrategy(cardMaskStrategy) {
    if (cardMaskStrategy !== this._cardMaskStrategy) {
      this._cardMaskStrategy = cardMaskStrategy;
      this._syncMask();
    }
  }

  /**
   * Returns a masked version of the current formatted PAN. Example:
   *
   * @example
   *     field.setText('4111 1111 1111 1111');
   *     field.cardMask(); // "•••• •••• •••• 1111"
   *
   * @returns {string} Returns a masked card string.
   */
  cardMask() {
    var text   = this.text();
    var toMask = text.slice(0, -4);
    var last4  = text.slice(-4);

    return toMask.replace(/\d/g, '•') + last4;
  }

  /**
   * Gets the formatted PAN for this field.
   *
   * @returns {string}
   */
  text() {
    if (this._masked) {
      return this._unmaskedText;
    } else {
      return super.text();
    }
  }

  /**
   * Sets the formatted PAN for this field.
   *
   * @param {string} text A formatted PAN.
   */
  setText(text) {
    if (this._masked) {
      this._unmaskedText = text;
      text = this.cardMask();
    }
    super.setText(text);
  }

  /**
   * Called by our superclass, used to implement card masking.
   *
   * @private
   */
  textFieldDidEndEditing() {
    this._editing = false;
    this._syncMask();
  }

  /**
   * Called by our superclass, used to implement card masking.
   *
   * @private
   */
  textFieldDidBeginEditing() {
    this._editing = true;
    this._syncMask();
  }

  /**
   * Enables masking if it is not already enabled.
   *
   * @private
   */
  _enableMasking() {
    if (!this._masked) {
      this._unmaskedText = this.text();
      this._masked = true;
      this.setText(this._unmaskedText);
    }
  }

  /**
   * Disables masking if it is currently enabled.
   *
   * @private
   */
  _disableMasking() {
    if (this._masked) {
      this._masked = false;
      this.setText(this._unmaskedText);
      this._unmaskedText = null;
    }
  }

  /**
   * Enables or disables masking based on the mask settings.
   *
   * @private
   */
  _syncMask() {
    if (this.cardMaskStrategy() === CardMaskStrategy.DoneEditing) {
      if (this._editing) {
        this._disableMasking();
      } else {
        this._enableMasking();
      }
    }
  }

  /**
   * Enum for card mask strategies.
   *
   * @readonly
   * @enum {number}
   */
  static get CardMaskStrategy() {
    return CardMaskStrategy;
  }
}

export default CardTextField;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Externals</h3><ul><li><a href="external-InputSim.html">InputSim</a></li></ul><h3>Classes</h3><ul><li><a href="AdaptiveCardFormatter.html">AdaptiveCardFormatter</a></li><li><a href="AmexCardFormatter.html">AmexCardFormatter</a></li><li><a href="CardTextField.html">CardTextField</a></li><li><a href="DefaultCardFormatter.html">DefaultCardFormatter</a></li><li><a href="DelimitedTextFormatter.html">DelimitedTextFormatter</a></li><li><a href="ExpiryDateField.html">ExpiryDateField</a></li><li><a href="ExpiryDateFormatter.html">ExpiryDateFormatter</a></li><li><a href="Formatter.html">Formatter</a></li><li><a href="NumberFormatter.html">NumberFormatter</a></li><li><a href="PhoneFormatter.html">PhoneFormatter</a></li><li><a href="SocialSecurityNumberFormatter.html">SocialSecurityNumberFormatter</a></li><li><a href="TextField.html">TextField</a></li><li><a href="UndoManager.html">UndoManager</a></li></ul><h3>Namespaces</h3><ul><li><a href="CurrencyDefaults.html">CurrencyDefaults</a></li><li><a href="FieldKit.html">FieldKit</a></li><li><a href="KEYS.html">KEYS</a></li><li><a href="LocaleDefaults.html">LocaleDefaults</a></li><li><a href="RegionDefaults.html">RegionDefaults</a></li><li><a href="StyleDefaults.html">StyleDefaults</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-dev</a> on Fri Jul 17 2015 15:36:07 GMT-0700 (PDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
